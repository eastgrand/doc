# Scoring Algorithms Analysis: Current vs Intended Design

## Overview

This document analyzes the actual scoring algorithms generated by the data-driven scoring system, identifies the current limitations, and explains what each algorithm should contain for proper analysis-specific scoring.

## Current State Analysis

### What's Actually Generated (Problem Identified)

**ðŸš¨ Issue**: All 26 scoring scripts currently use the **same algorithm**:

```javascript
// All scripts use identical logic:
Formula: {analysis_type}_score = (1.000 Ã— MP10128A_B_P_normalized)
Components: 1 total
Field: MP10128A_B_P (weight: 1.000)
```

**Examples:**
- Strategic Analysis: `strategic_analysis_score = 1.000 Ã— MP10128A_B_P`
- Brand Difference: `brand_difference_score = 1.000 Ã— MP10128A_B_P`  
- Predictive Modeling: `predictive_modeling_score = 1.000 Ã— MP10128A_B_P`
- Demographic Insights: `demographic_insights_score = 1.000 Ã— MP10128A_B_P`

### Why This Happened

**Root Cause**: The SHAP extractor (`shap_extractor.py`) is only returning the target variable instead of analyzing all available fields for each analysis type.

**Current Logic Flow:**
1. System reads target variable `MP10128A_B_P` from training results
2. Uses only this target variable for all analysis types
3. Assigns weight 1.000 to the single field
4. All 26 scripts end up identical

## Available Data Fields

**Sample of Available Fields for Analysis:**
```json
{
  "MP10104A_B_P": 17.39,    // TurboTax usage %
  "MP10002A_B_P": 13.04,    // Another brand %
  "MP10128A_B_P": 3.12,     // H&R Block % (current target)
  "MP10138A_B_P": 2.06,     // Another service %
  "X14060_X": 102753,       // Population count
  "X14068_X": 13781,        // Income data
  // ... hundreds more fields
}
```

## What Each Algorithm Should Contain

### Strategic Analysis Algorithm
**Purpose**: Market positioning and strategic opportunity scoring
**Expected Fields**:
- Market share indicators (MP fields)
- Population demographics (X14060_X series)
- Income levels (X14068_X series)
- Geographic factors (Shape__Area, coordinates)

**Expected Formula**:
```javascript
strategic_analysis_score = 
  (0.35 Ã— market_share_normalized) + 
  (0.25 Ã— population_density_normalized) + 
  (0.20 Ã— income_level_normalized) + 
  (0.20 Ã— geographic_opportunity_normalized)
```

**Field Determination**: 
- Market share: Highest MP field values indicate market opportunity
- Population: Large populations = bigger market potential
- Income: Higher income = more service adoption potential
- Geography: Area size affects service delivery strategy

### Brand Difference Algorithm
**Purpose**: Compare competitive brand performance
**Expected Fields**:
- H&R Block usage: MP10128A_B_P
- TurboTax usage: MP10104A_B_P
- Other tax services: MP10002A_B_P, MP10138A_B_P
- Market size factors: Population data

**Expected Formula**:
```javascript
brand_difference_score = 
  (0.40 Ã— hrblock_vs_competitors_ratio) + 
  (0.30 Ã— market_penetration_opportunity) + 
  (0.30 Ã— market_size_factor)
```

**Field Determination**:
- Direct brand comparison using actual usage percentages
- Calculate opportunity gaps between brands
- Weight by market size for strategic prioritization

### Demographic Insights Algorithm
**Purpose**: Population and demographic pattern analysis
**Expected Fields**:
- Age demographics (various age bracket fields)
- Income distribution (X14068_X series)
- Education levels (education-related fields)
- Population density (X14060_X series)

**Expected Formula**:
```javascript
demographic_insights_score = 
  (0.30 Ã— target_age_concentration) + 
  (0.25 Ã— income_compatibility) + 
  (0.25 Ã— education_alignment) + 
  (0.20 Ã— population_density)
```

**Field Determination**:
- Target demographics: Age groups most likely to use tax services
- Income compatibility: Income levels that correlate with service adoption
- Education: Higher education often correlates with tax service usage
- Density: Population concentration affects service delivery

### Predictive Modeling Algorithm
**Purpose**: Forecasting and prediction accuracy assessment
**Expected Fields**:
- Historical trend indicators
- Market growth factors
- Seasonal usage patterns
- Economic indicators

**Expected Formula**:
```javascript
predictive_modeling_score = 
  (0.40 Ã— trend_consistency) + 
  (0.30 Ã— growth_potential) + 
  (0.30 Ã— market_stability)
```

### Spatial Clusters Algorithm
**Purpose**: Geographic clustering and spatial analysis
**Expected Fields**:
- Geographic coordinates (LATITUDE, LONGITUDE)
- Area measurements (Shape__Area, Shape__Length)
- Population density
- Service accessibility factors

**Expected Formula**:
```javascript
spatial_clusters_score = 
  (0.35 Ã— cluster_density) + 
  (0.25 Ã— geographic_accessibility) + 
  (0.25 Ã— population_concentration) + 
  (0.15 Ã— service_coverage_gap)
```

## How Field Selection Should Work

### 1. Analysis-Specific Relevance Scoring
**Current System Has This Logic** (but not being used properly):

```python
relevance_patterns = {
    'strategic_analysis': ['mp', 'market', 'share', 'income', 'population', 'demographic'],
    'competitive_analysis': ['mp', 'market', 'share', 'brand', 'competition'],
    'demographic_insights': ['age', 'income', 'education', 'population', 'demographic'],
    'spatial_clusters': ['geographic', 'spatial', 'location', 'cluster', 'area'],
    'brand_difference': ['mp', 'brand', 'market', 'share', 'competition']
}
```

### 2. Field Importance Calculation
**Should analyze all available fields**:
1. Calculate correlation with target variable
2. Apply analysis-specific relevance patterns
3. Prioritize percentage fields (`_P` suffix)
4. Generate multi-field algorithms

### 3. Algorithm Generation Process
**For each analysis type**:
1. **Field Discovery**: Find all fields matching relevance patterns
2. **Importance Ranking**: Rank by correlation + relevance score
3. **Field Selection**: Choose top 3-6 fields for algorithm
4. **Weight Calculation**: Distribute weights based on importance
5. **Formula Generation**: Create mathematical formula with selected fields

## Required System Fixes

### 1. Fix SHAP Extractor
**Problem**: Only returning target variable
**Solution**: Analyze all available fields for each analysis type

### 2. Implement True Multi-Field Algorithms
**Current**: Single field with weight 1.000
**Needed**: Multiple fields with distributed weights

### 3. Analysis-Specific Field Selection
**Current**: Same field for all analysis types
**Needed**: Different field combinations per analysis type

### 4. Proper Algorithm Documentation
**Current**: Generic "data-driven importance"
**Needed**: Specific justification for each field selection

## Expected Outcome

**After Fixes, Each Algorithm Should Have**:
1. **Unique field combinations** relevant to the analysis type
2. **Multiple fields** (3-6 fields per algorithm)
3. **Justified field selection** based on analysis requirements
4. **Distributed weights** based on field importance
5. **Analysis-specific scoring logic**

## Implementation Priority

1. **High Priority**: Fix SHAP extractor to analyze all fields
2. **High Priority**: Implement multi-field algorithm generation
3. **Medium Priority**: Add analysis-specific validation
4. **Low Priority**: Optimize field selection algorithms

---

**Status**: Current system generates identical algorithms for all analysis types. Needs significant enhancement to create truly analysis-specific scoring algorithms.